const pgp = require('pg-promise')()
const db = pgp({
  host: 'localhost',
  port: 5432,
  database: 'pokemon',
  user: 'pokemon',
  // Note to others:
  // If i do somehow commit this then you should know
  // that this role has really shitty perms
  // and my postgres server only accepts local connections
  // so you'd need to hack into my server
  // just to be able to delete all the rows or something

  // If i leave this in and commit however, feel free to call me dumb :)
  password: '86W2D0QfZlXtschw'
})

const fetchPokemon = require('./_scrapePokemon')

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

const startId = 785

// db.none('DELETE FROM pokemon WHERE id < $1;', startId + 1);

;(async function loadPoke(i) {
  console.log('Getting pokemon #', i)

  try {
    data = await fetchPokemon(db, i)
    console.log('Got:', data.name)
  } catch (e) {
    console.error(e)
    console.log('while getting pokemon #', i)
    return
  }

  if (i > 1000) {
    console.log('Done!')
    return
  } else {
    // wait 5s before continuing
    await sleep(3 * 1000)
    loadPoke(i + 1)
  }
})(startId)
